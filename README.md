<h1>MQ를 이용한 대량의 데이터 처리</h1>

<h3>1. 도입 목적</h3>

- 비동기, 확장성, 보증성
- 부하 분산 처리
- 데이터 손실 방지

<br/>

<h3>2. 기존 처리 방식</h3>

![image](https://github.com/user-attachments/assets/e01c9def-7943-4684-b7a2-4242f0e065b7)
> 요청이 들어오면 중간 과정 없이 그대로 서버가 받아서 처리하는 구조
- 처리해야 할 데이터가 많아지니 과부하 발생
- 그에 따라 정상적으로 처리되지않고 유실되는 데이터 발생

<br/>

<h3>3. 개선 방안</h3>

![111123](https://github.com/user-attachments/assets/6ecc9f67-4951-4ba6-9bc3-3935d626cec1)

> AMQP 도입, 중간에서 분산 처리하는 구조로 개선
- 처리해야 할 데이터를 분산해줌으로써, 프로세스 안정화
- 결론적으로, 전송된 메세지의 보장성 제공
  
<br/>

<h3>4. 테스트 결과</h3>

<h4>1. Apache JMeter을 사용하여 부하 테스트 진행</h4>
- 초당 5000건, 60초간 총 300,000건의 Request 

<br/>
<br/>

<h4>2. AMQP 도입 전</h4>

![image](https://github.com/user-attachments/assets/ce7301a9-1e7a-47f4-ae16-1fe103d518e6)
> 프로세스 과부하로 인하여 요청 전체를 처리하지 못 하고 Timeout이 발생한 데이터가 생김
  
<br/>

<h4>3. AMQP 도입 후</h4>

![image](https://github.com/user-attachments/assets/cd4f2f4c-2210-4828-ad8c-a11de964364c)
> 리스닝중인 프로세스가 과부하가 발생하지 않게 관리하여 유실된 데이터 없이 전체 처리 완료

<br/>

<h1>멀티 스레드와 스레드 풀</h1>

<h3>1. 도입 목적</h3>

- MQ로 부하 분산 처리를 하였지만 허용량 이상의 요청이 들어오거나,<br/>
  로직 자체가 복잡하여 수행 시간이 오래 걸린다면 결론적으로 과부하가 발생하는 문제 개선

<br/>

<h3>2. 기존 처리 방식</h3>

![image](https://github.com/user-attachments/assets/ea45ae00-d08e-48e4-b9b5-1ae7d14e7ed3)
> 다른 요청에 의하여 기존 스레드의 처리가 지연되면 나머지 요청의 처리도 같이 지연되는 현상 발생
- 단일 스레드의 처리 속도가 요청 건수를 따라가지 못해 나머지 요청의 처리가 늦어짐

<br/>

<h3>3-1. 개선 방안 ①</h3>

![image](https://github.com/user-attachments/assets/20f20fb0-3af0-4b4c-95f3-247284a19b9d)
> 스레드의 개수를 늘리는 멀티 스레드 방식
- 장점
  - 하나의 스레드 처리가 지연되어도, 다른 스레드는 정상 동작하여 다중 요청 처리 가능
  - 프로세스간 자원을 공유하기 때문에 효율적인 자원 관리 가능
- 단점
  - 프로세스간 자원을 공유하기 때문에 동기화 문제가 발생할 수 있음(데이터의 일관성을 유지하기 위해 추가 작업 필요)
  - 스레드의 무분별한 생성은 시스템 성능에 영향을 끼침(평균 요청량 및 응답시간 등 철저하게 분석을 하여 적정량의 스레드 생성이 필요)

<br/>

<h3>3-2. 개선 방안 ②</h3>

![image](https://github.com/user-attachments/assets/d22ed1a5-6cce-4983-a1c8-e3bbdce3db4d)
> 미리 스레드를 생성해놓는 스레드 풀 방식<br/>
(생성된 스레드는 대기상태에 놓여있다가 요청이 발생하면 할당하여 해당 요청을 처리한 후 다시 대기상태로 돌아가는 방식)
- 장점
  - 정해진 개수의 스레드를 미리 생성하고 관리하기 때문에 스레드 생성/삭제시 발생하는 자원의 소모가 절약됨
  - 과도한 요청이 발생해도 설정해놓은 개수의 스레드만 생성되기 때문에 시스템의 부하가 줄어듦
- 단점
  - 요청량에 비해 스레드 풀의 개수가 과도하게 많다면 이는 성능저하로 이어짐(시스템에 대한 이해를 바탕으로 적정량의 스레드 풀 설정)
  - 생성가능한 개수가 정해져 있기 때문에 모든 스레드가 사용중이라면 다른 요청들은 지연될 수 있음(사용량 분석)
 
  
